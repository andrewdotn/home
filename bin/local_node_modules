#!/bin/bash

set -eu

# I don’t mind yarn taking up lots of disk space, but I don’t want it
# wasting space in backups, and I want to be able to clear out node_modules
# for old throwaway projects easily.

root_dir=~/Downloads/project-node-modules
project_name="$(echo "${PWD}" | sed -e 's,/,_,g')"
target_dir="${root_dir}/${project_name}"
# All sorts of things break if the symlinked target isn’t called
# “node_modules”
module_dir="${target_dir}/node_modules"

if ! [ -L node_modules ]; then
    if [ -d node_modules ]; then
        mkdir -p "${target_dir}"
        mv node_modules "${module_dir}"
    else
        mkdir -p "${module_dir}"
    fi
    ln -s "${module_dir}" node_modules
fi
